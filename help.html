<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LEGO Workshop</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/custom.css">
    <script src="js/codemirror.js"></script>
    <script src="js/python.js"></script>
    <script src="js/mes_fonctions.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <img class="logo" src="img/lego_mindstorm_ev3.png" />
        <a class="navbar-brand" href="#"> :: LEGO Workshop ::</a>
        <img class="logo" src="img/lego_mindstorm_ev3.png" />
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <form class="form-inline my-2 my-lg-0">
                <input id="pseudo" class="form-control mr-sm-2" type="text" value="...">
                <button id="executer" type="button" class="btn btn-success my-2 my-sm-0">Start</button>
                <button id="arreter" type="button" class="btn btn-danger my-2 my-sm-0">Stop</button>
                <a href="./help.html" target="_blank"><button id="aider" type="button" class="btn btn-info my-2 my-sm-0">Help</button></a>
            </form>
        </div>
    </nav>

    <main role="main" class="container">

        <h2>[Examples]</h2>
        <div id="zone_ide">
            <form>
                <textarea id="code_source">
"""
@brief Exemples d'utilisation de l'API ev3dev Python pour le robot Lego EV3
@author David SALLE, Julien SIMONNEAU
@date 27/01/2017
@version 0.2
"""

###############
### L'écran ###
###############
# Librairies utilisées
import ev3dev.ev3 as ev3

# Création de l'écran
ecran = ev3.Screen()

# Afficher un texte au point (10,10) de l'écran
ecran.draw.text((10,10), "Hello World!")
ecran.update()



######################
### Le son (parlé) ###
######################
# Librairies utilisées
import ev3dev.ev3 as ev3

# Le robot parle
ev3.Sound.speak("Hello World").wait()



#######################
### Le son (buzzer) ###
#######################
# Librairies utilisées
import ev3dev.ev3 as ev3

# Que la force soit avec vous...
ev3.Sound.tone([
    (392, 350, 100), (392, 350, 100), (392, 350, 100),
    (311.1, 250, 100), (466.2, 25, 100), (392, 350, 100),
    (311.1, 250, 100), (466.2, 25, 100), (392, 700, 100),
    (587.32, 350, 100), (587.32, 350, 100), (587.32, 350, 100),
    (622.26, 250, 100), (466.2, 25, 100), (369.99, 350, 100),
    (311.1, 250, 100), (466.2, 25, 100), (392, 700, 100),
    (784, 350, 100), (392, 250, 100), (392, 25, 100),
    (784, 350, 100), (739.98, 250, 100), (698.46, 25, 100),
    (659.26, 25, 100), (622.26, 25, 100), (659.26, 50, 400),
    (415.3, 25, 200), (554.36, 350, 100), (523.25, 250, 100),
    (493.88, 25, 100), (466.16, 25, 100), (440, 25, 100),
    (466.16, 50, 400), (311.13, 25, 200), (369.99, 350, 100),
    (311.13, 250, 100), (392, 25, 100), (466.16, 350, 100),
    (392, 250, 100), (466.16, 25, 100), (587.32, 700, 100),
    (784, 350, 100), (392, 250, 100), (392, 25, 100),
    (784, 350, 100), (739.98, 250, 100), (698.46, 25, 100),
    (659.26, 25, 100), (622.26, 25, 100), (659.26, 50, 400),
    (415.3, 25, 200), (554.36, 350, 100), (523.25, 250, 100),
    (493.88, 25, 100), (466.16, 25, 100), (440, 25, 100),
    (466.16, 50, 400), (311.13, 25, 200), (392, 350, 100),
    (311.13, 250, 100), (466.16, 25, 100), (392.00, 300, 150),
    (311.13, 250, 100), (466.16, 25, 100), (392, 700) ]).wait()



############################
### Le son (fichier WAV) ###
############################
# Librairies utilisées
import ev3dev.ev3 as ev3

# Le robot parle
ev3.Sound.play("hammond.wav").wait()



################
### Les LEDs ###
################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# On allume la led gauche en orange
ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.ORANGE)

# Pause d'1 seconde
time.sleep(1)

# On allume la led gauche en vert
ev3.Leds.set_color(ev3.Leds.RIGHT, ev3.Leds.GREEN)

# Pause d'1 seconde
time.sleep(1)

# On éteint toutes les leds
ev3.Leds.all_off()



###################
### Les boutons ###
###################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du gestionnaire de boutons
gb = ev3.Button()

# Boucle de test sur 10s
for i in range(0, 100):
    if gb.down == True:   # Appui sur le bouton [BAS]
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.RED)
    if gb.up == True:     # Appui sur le bouton [HAUT]
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.YELLOW)
    time.sleep(0.1)



#############################
### Le capteur de contact ###
#############################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du capteur de contact
ts = ev3.TouchSensor()

# Tant qu'il n'est pas enfoncé, on allume la led verte
while ts.is_pressed() == False:
    ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.GREEN)

# Si il est enfoncé, on allume la led rouge
if ts.is_pressed() == True:
    ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.RED)
   time.sleep(2)

# Puis on éteint tout
ev3.Leds.all_off()



#######################################
### Le capteur lumineux (réflexion) ###
#######################################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du capteur lumineux
cs = ev3.ColorSensor()

# Pendant 10 secondes on change la led selon la lumière
for i in range(0, 10):
    if cs.reflected_light_intensity() < 50:
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.RED)
    else:
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.GREEN)
    time.sleep(1)

# On éteint tout
ev3.Leds.all_off()



#####################################
### Le capteur lumineux (couleur) ###
#####################################
# Librairies utilisées
import ev3dev.ev3 as ev3

# Création du capteur lumineux
cs = ev3.ColorSensor()

# Tant que la couleur n'est pas blanche...
while cs.color() != 6:
    if cs.color() == 5:
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.RED)
    if cs.color() == 3:
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.GREEN)
    if cs.color() == 4:
        ev3.Leds.set_color(ev3.Leds.LEFT, ev3.Leds.YELLOW)

# On éteint tout
ev3.Leds.all_off()



###########################
### Le capteur ultrason ###
###########################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du capteur ultrason et de l'écran
us = ev3.UltrasonicSensor()
ecran = ev3.Screen()

# Pendant 10 secondes on lit et affiche la distance en millimètres
for i in range(0, 100):
    distance = us.distance_centimeters()
    ecran.draw.text((10,10), "Distance = %d mm" % distance)
    ecran.update()
    time.sleep(0.1)
    ecran.clear()



###############################
### Le capteur gyroscopique ###
###############################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du capteur ultrason et de l'écran
gs = ev3.GyroSensor()
ecran = ev3.Screen()

# Pendant 10 secondes on lit et affiche l’angle
for i in range(0, 100):
    angle = gs.angle()
    ecran.draw.text((10,10), "Angle = %d degres" % angle)
    ecran.update()
    time.sleep(0.1)
    ecran.clear()



###############################
### Le moteur (mode direct) ###
###############################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création des moteurs gauche et droit reliés aux ports A et C
mg = ev3.LargeMotor("outA")
md = ev3.LargeMotor("outC")

# Les moteurs tournent pendant 2s
mg.run_direct(duty_cycle_sp=100)  # puissance=100%
md.run_direct(duty_cycle_sp=-100) # puissance=-100%
time.sleep(2)
mg.stop()
md.stop()



##############################
### Le moteur (mode timed) ###
##############################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création des moteurs gauche et droit reliés aux ports A et C
mg = ev3.LargeMotor("outA")
md = ev3.LargeMotor("outC")

# Les moteurs tournent pendant 1s
mg.run_timed(time_sp=1000, duty_cycle_sp=100)
md.run_timed(time_sp=1000, duty_cycle_sp=-100)



################################
### Le moteur (mode relatif) ###
################################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création des moteurs gauche et droit reliés aux ports A et C
mg = ev3.LargeMotor("outA")
md = ev3.LargeMotor("outC")

# Les moteurs tournent sur 360 degrés (90 * 4 = 360)
mg.run_to_rel_pos(position_sp=90, duty_cycle_sp=100)
md.run_to_rel_pos(position_sp=90, duty_cycle_sp=100)



##########################
### Template robotique ###
##########################
# Librairies utilisées
import ev3dev.ev3 as ev3
import time

# Création du gestionnaire de boutons
b = ev3.Button()

# Boucle principale du robot
while (b.any() == False):

    # Faire quelque chose...
    pass

                </textarea>
            </form>

        </div><!-- zone_ide -->
    </main>


    <script type="text/javascript" charset="utf-8">

        // Les variables
        var bouton_executer = document.getElementById("executer");
        var bouton_arreter = document.getElementById("arreter");

        // Initialisation des boutons
        bouton_executer.disabled = true;
        bouton_arreter.disabled = true;

        // Configuration de l'éditeur en ligne Python
        var editeur = CodeMirror.fromTextArea(document.getElementById("code_source"), {
            mode: {name: "python",
                   version: 3,
                   singleLineStringErrors: false},
            lineNumbers: true,
            indentUnit: 4,
            matchBrackets: true
            //viewportMargin: Infinity
        });
        editeur.setSize(900, 600);

    </script>

</body>

</html>
